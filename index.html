<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
    <title>OOTP World Editor</title>
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
	<script type="text/javascript" src="./scripts/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="./scripts/jstree.min.js"></script>
    <link href="./scripts/default/style.min.css" rel="stylesheet">
    <script>
        const { ipcRenderer } = require('electron');
        var max_world_id = 0
        var max_continent_id = 0
        var max_nation_id = 0
        var max_state_id = 0
        var max_city_id = 0
        var world_count = 0
        var continent_count = 0
        var nation_count = 0
        var state_count = 0
        var city_count = 0
    </script>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
    </style>
</head>
<body>
    <div id="footer" style="position:absolute; bottom:0; left:0; width:100%; height:50px; text-align:center;">
        <table style="width:90%; margin: 0 auto">
            <tr>
                <td>CONTINENTS: <span id="continent_count">0</span></td>
                <td>NATIONS: <span id="nation_count">0</span></td>
                <td>STATES: <span id="state_count">0</span></td>
                <td>CITIES: <span id="city_count">0</span></td>
            </tr>
            <tr>
                <td>MAX_CONTINENT_ID: <span id="max_continent_id">0</span></td>
                <td>MAX_NATION_ID: <span id="max_nation_id">0</span></td>
                <td>MAX_STATE_ID: <span id="max_state_id">0</span></td>
                <td>MAX_CITY_ID: <span id="max_city_id">0</span></td>
            </tr>
        </table>    
    </div>
    <input type="button" id="loadXML" value="Load XML file">
    <div id="xmlOutput">I'M WAITING</div>
</body>
<script>
    $("#loadXML").on("click",function(e) {
        ipcRenderer.send('open-xml', null)
    })

    ipcRenderer.on('xml-opened', (event, result) => {
        if (result != 'cancelled') {
            var json = JSON.parse(result)
            for (continent of json.WORLD.CONTINENTS[0].CONTINENT) {
                console.log(continent.$.name)
                continent_count++;            
                if (parseInt(continent.$.id) > max_continent_id) { max_continent_id = parseInt(continent.$.id) }
                for (nation of continent.NATIONS[0].NATION) {
                    console.log("  "+nation.$.name)
                    nation_count++;                
                    if (parseInt(nation.$.id) > max_nation_id) { max_nation_id = parseInt(nation.$.id) }
                    for (state of nation.STATES[0].STATE) {
                        console.log("    "+state.$.name)
                        state_count++; 
                        if (parseInt(state.$.id) > max_state_id) { max_state_id = parseInt(state.$.id) }
                        if (state.CITIES[0].CITY != undefined) {
                            for (city of state.CITIES[0].CITY) {
                                console.log("      "+city.$.name)
                                city_count++;
                                if (parseInt(city.$.id) > max_city_id) { max_city_id = parseInt(city.$.id) }
                            }
                        }
                    }
                }
            }
            $("#continent_count").text(continent_count)
            $("#nation_count").text(nation_count)
            $("#state_count").text(state_count)
            $("#city_count").text(city_count)
            $("#max_continent_id").text(max_continent_id)
            $("#max_nation_id").text(max_nation_id)
            $("#max_state_id").text(max_state_id)
            $("#max_city_id").text(max_city_id)
            /* $("#xmlOutput").html("max_continent: "+max_continent+"<br>\n"
                                +"max_nation: "+max_nation+"<br>\n"
                                +"max_state: "+max_state+"<br>\n"
                                +"max_city:" +max_city+"<br><br>\n"
                                +"CONTINENTS: "+continent_count+"<br>\n"
                                +"NATIONS: "+nation_count+"<br>\n"
                                +"STATES: "+state_count+"<br>\n"
                                +"CITIES: "+city_count+"<br>") */
        } else {
            alert("cancelled!")
        }
    });
</script>
</html>